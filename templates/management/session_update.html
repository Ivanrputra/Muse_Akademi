{% extends 'classroom/base_app.html' %}
{% load widget_tweaks %}

{% block body_css %}
{{ form.media.css }}
<link href="//cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css"
	type="text/css" media="all" rel="stylesheet">
<style>
	.callout-error {
		border-left: 5px solid #ff6b6b !important;
		padding: 10px 15px;
		color: #ff6b6b;
	}

	.callout-error ul {
		list-style: none;
		margin: 0 !important;
		padding: 0 !important;
	}
</style>
{% endblock %}

{% block title_nav %} {{ course.title }} {% endblock %}

{% block classroom_menu %}
    {% include 'ext/classroom_menu.html' with course=course %}
{% endblock %}

{% block body_block %}

<div class="container-fluid mb-5">
	<div class="row mt-lg-5">
		<div class="col-12 col-lg-11 mb-3">
			<h5>Edit Sesi</h5>
		</div>
	</div>

	<div class="row">
		<div class="col-12 col-lg-11 mb-3">
			<div class="card">
				<div class="card-header">Form Edit Sesi</div>
				<div class="card-body">
					<form method="POST" enctype="multipart/form-data">

						{% csrf_token %}
						<div class="row">
                            <div class="col-12 form-group">
                                <label for="session-name">Nama Sesi</label>
                                {% render_field form.title class+='form-control' %}
                            </div>
                            <div class="col-12 form-group">
                                <label for="session-mentor">Mentor</label>
                                {% render_field form.mentor class+='form-control' %}
                            </div>
                            <div class="col-12 form-group">
                                <label for="session-description">Deskripsi</label>
                                {% render_field form.description class+='form-control' %}
                            </div>
                            <div class="col-12 form-group">
                                <label for="session-date">Tanggal</label>
                                {{ form.start_at }}
                                {% if form.start_at.errors %}
                                    <div class="card callout-error mt-3">
                                        {{form.start_at.errors}}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="col-12">
                                <button class="submit" class="btn btn-primary">Edit Sesi</button>
                                <a href="{% url 'management:classroom' course.id %}" class="btn btn-danger ml-2">Batal</a>
                            </div>
                        </div>


					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-12 col-lg-11 mb-3">
			<div class="card">
				<div class="card-header">Form Modul</div>
				<div class="card-body">
					<div class="row">
						<div class="col-12">
							<form method="post" action="{% url 'management:sessiondata' session.id %}"
								enctype="multipart/form-data">
								{% csrf_token %}
								<div class="form-group">
									{% render_field form_sessiondata.title class+='form-control' placeholder='Nama Modul' %}
								</div>
								<div class="form-group">
									<div class="input-group">
										{% render_field form_sessiondata.attachment class+="custom-file-input" accept="application/pdf" %}
										<label class="custom-file-label">Upload File PDF</label>
									</div>
								</div>
								<div class="form-group">
									<button type="submit" class="btn btn-primary">Tambah Data</button>
								</div>
							</form>
						</div>
					</div>
					
					
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-12 col-lg-11 mb-3">
			<div class="card">
				<div class="card-header">File Modul</div>
				<div class="card-body">
					<ul class="list-group list-group-flush mb-3">
						{% for session_data in session.session_datas %}
						<li class="list-group-item d-flex justify-content-between align-items-center">
							<a href="#!">
								<span>{{session_data.title}}</span>
							</a>
							<a href="javascript:void(0)" class="btn btn-link p-0 btn-delete"
								data-id="{{ session_data.id }}" data-toggle="modal" data-target="#modalDelete">
								<i class="las la-trash text-danger" style="font-size: 1.3em"></i>
							</a>
						</li>
						{% empty %}
						<li class="small text-center" style="list-style: none;">
							<em>Belum ada modul.</em>
						</li>
						{% endfor %}
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="modalDelete" tabindex="-1" aria-labelledby="modalDeleteLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="formDelete" action="" method="POST">
                {% csrf_token %}
                <div class="modal-header">
                    <h6 class="modal-title" id="modalDeleteLabel">Hapus Modul</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Anda yakin menghapus modul ini?</p>   
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-danger">Hapus</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block body_js %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
{{ form.media.js }}

<script>
	$('input[type=file').on('change', function() {
		$(this).next('label').text($(this).val().split('\\').pop())
	});
	
	$('.btn-delete').on('click', function() {
		let url = "{% url 'management:sessiondata-delete' 777 %}";
		let id = $(this).data('id');
		console.log(id);
		$('#formDelete').attr('action', url.replace('777', id));
	});
</script>

{% endblock %}