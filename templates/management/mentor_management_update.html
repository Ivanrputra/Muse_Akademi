{% extends 'base_app.html' %}
{% load custom_filter %}
{% load widget_tweaks %}

{% block body_css %}
<style>
    

    table#schedule-table td,
    #schedule-table .table td {
        text-align: center;
        padding: 0px;
    }

    #schedule-table .table th {
        padding: 5px !important;
        text-align: center;
    }

    td.checked {
        background-color: #3abcd8;
    }
</style>
{% endblock %}

{% block body_block %}

<div class="container mb-5">
	<div class="row mt-lg-5">
		<div class="col-12 col-lg-3">
			
			<div class="side-menu-top">
				<img src="{{ mentor_data.mentor.profile_pic|profile_pic }}" alt="profile-pic">
				<span class="mt-3">{{ mentor_data.mentor }}</span>
				<span class="text-muted small">{{ mentor_data.mentor.username }}</span>
			</div>
			<form method="POST" enctype="multipart/form-data" class="mt-4">
				{% csrf_token %}
				<div class="form-group">
					{% render_field form.status class+='form-control' %}
				</div>
				
				<div class="form-group">
					<button type="submit" class="btn btn-block btn-sm btn-primary">Simpan Perubahan</button>
				</div>
			</form>
			
		</div>
		<div class="col-12 col-lg-9">
			<h5>Data Mentor</h5>
			<p class="small text-muted">Anda dapat melihat informasi dan berkas dari mentor ini.</p>
			<div class="row">
				<div class="col-12 mb-3">
					<div class="card">
						<div class="card-body">
							<h6 class="card-title">Informasi Mentor</h6>
							<table class="table table-borderless small">
								<tbody>
									<tr>
										<th scope="row" width="20%">Nama</th>
										<td>: {{ mentor_data.mentor }}</td>
									</tr>
									<tr>
										<th scope="row">Email</th>
										<td>: {{ mentor_data.mentor.email }}</td>
									</tr>
									<tr>
										<th scope="row">No. Telepon</th>
										<td>: {{ mentor_data.mentor.phone }}</td>
									</tr>
									<tr>
										<th scope="row">Alamat</th>
										<td>: {{ mentor_data.mentor.address }}</td>
									</tr>
									<tr>
										<th scope="row">Jadwal</th>
										<td>: <a href="#modalSchedule" data-toggle="modal">Lihat Jadwal</a></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
				<div class="col-12 mb-3">
					<div class="card">
						<div class="card-body">
							<h6 class="card-title">Berkas Mentor</h6>
							<table class="table table-borderless small">
								<tbody>
									<tr>
										<th scope="row" width="20%">Nomor KTP</th>
										<td>: {{ mentor_data.no_ktp }}</td>
									</tr>
									<tr>
										<th scope="row">Scan KTP</th>
										<td>: 
											<a href="{{mentor_data.ktp|data_default}}" target="_blank">
												<i class="las la-file-image mr-1"></i>
												<span>File KTP</span>
											</a>
										</td>
									</tr>
									<tr>
										<th scope="row">File Sertifikasi</th>
										<td>: 
											<a href="{{mentor_data.certification|data_default}}" target="_blank">
												<i class="las la-file-pdf mr-1"></i>
												<span>File Sertifikasi</span>
											</a>
										</td>
									</tr>
									<tr>
										<th scope="row">File CV</th>
										<td>: 
											<a href="{{mentor_data.cv|data_default}}" target="_blank">
												<i class="las la-file-pdf mr-1"></i>
												<span>File CV</span>
											</a>
										</td>
									</tr>
									<tr>
										<th scope="row">Portofolio</th>
										<td>: 
											<a href="{{mentor_data.portofolio|data_default}}" target="_blank">
												<i class="las la-file-pdf mr-1"></i>
												<span>File Portofolio</span>
											</a>
										</td>
									</tr>
									<tr>
										<th scope="row">NPWP</th>
										<td>: 
											<a href="{{mentor_data.npwp|data_default}}" target="_blank">
												<i class="las la-file-pdf mr-1"></i>
												<span>File NPWP</span>
											</a>
										</td>
									</tr>
								</tbody>
							</table>
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="modalSchedule" tabindex="-1" aria-labelledby="modalScheduleLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="modalScheduleLabel">Jadwal Free Time Mentor</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="schedule-table" class="table-responsive">
					<table class="table table-bordered small">
						<thead>
							<tr>
								<th>Jam (GMT+7)</th>
								<th width="11%">Minggu</th>
								<th width="11%">Senin</th>
								<th width="11%">Selasa</th>
								<th width="11%">Rabu</th>
								<th width="11%">Kamis</th>
								<th width="11%">Jumat</th>
								<th width="11%">Sabtu</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="(item, i) in checklist">
								<th scoped="row"><span v-text="i+7"></span>.00</th>
								<td v-for="(subitem, j) in item" :class="{checked: subitem}"></td>

							</tr>
						</tbody>
					</table>
					
				</div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block body_js %}
<script>
	Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
	const scheduleTable = new Vue({
        el: '#schedule-table',
        data: {
            free_time_data: [],
            dayAssoc: ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"],
            checklist: [],
        },
        methods: {
            initSchedule: function (data) {
                for (var i = 7; i < 23; i++) {
                    arr = [];
                    for (var j = 0; j < 7; j++) {
                        let found = data.some(
                            (item) =>
                            item.day === this.dayAssoc[j] &&
                            parseInt(item.time.split(":", 1)) === i
                        );
                        if (found) {
                            arr.push(true);
                        } else {
                            arr.push(false);
                        }
                    }
                    this.checklist.push(arr);
                }
            },
        },
        created: function () {
			let api_url = `/api/mentor/schedule/?mentor={{ mentor_data.mentor.id }}`;
            this.$http.get(api_url)
                .then((response) => {
                    // data = this.free_time_data;
					console.log(response.data);
                    this.initSchedule(response.data);
                })
                .catch((err) => {
                    this.loading = false;
                    console.log(err);
                })
        }
    });
</script>
{% endblock %}